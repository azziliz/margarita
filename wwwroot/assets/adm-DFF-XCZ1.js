import{_ as g,d as h,c as n,o,a,b as t,t as l,F as u,r as p,e as d,g as y,h as f}from"./_plugin-vue_export-helper-BbTsJ6z5.js";const v=h({data(){return{state:"homepage",loading:!0,getmenuresponse:null,getinvoiceresponse:null,getuserresponse:null,getstaffresponse:null,postorderresponse:null,orderimpl:{}}},computed:{customerId(){return new URLSearchParams(window.location.search).get("customerId")},staffId(){return new URLSearchParams(window.location.search).get("staffId")}},async created(){await this.getMeAdm()},methods:{async getMeAdm(){this.loading=!0,this.getstaffresponse=null;var s=await fetch("api/staff/"+this.staffId);s.ok&&(this.getstaffresponse=await s.json(),this.loading=!1)},async getMeCust(){this.loading=!0,this.getuserresponse=null;var s=await fetch("api/users/"+this.customerId);s.ok&&(this.getuserresponse=await s.json(),this.loading=!1)},async getMenu(){this.getmenuresponse=null,this.orderimpl={};var s=await fetch("api/menu");s.ok&&(this.getmenuresponse=await s.json(),this.getmenuresponse.forEach(e=>{this.orderimpl[e.id]=0}))},async getMyInvoices(){this.getinvoiceresponse=null,this.orderimpl={};var s=await fetch("api/invoices/mine?cust="+this.customerId);s.ok&&(this.getinvoiceresponse=await s.json())},async goToOrder(){await this.getMenu(),this.state="order"},async goToOrderSent(){this.state="ordersent"},async goToInvoice(){await this.getMyInvoices(),this.state="invoice"},async goToHome(){this.state="homepage"},async postOrder(){this.postorderresponse=null;var s=await fetch("api/orders?cust="+this.customerId,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object.entries(this.orderimpl).map(e=>({menuId:e[0],amount:e[1]})))});s.ok&&await this.goToOrderSent()},formatDate(s){const e=new Date(s);return e.toLocaleDateString()+" à "+e.toLocaleTimeString()}}}),c={key:0,class:"margscreen"},k={key:0,class:"loading"},b={key:1,class:"content"},w={key:1,class:"margscreen"},C={key:0,class:"content"},I=["onClick"],T={key:0},O=["onClick"],$=["onClick"],A=["onClick"],M={key:0},S={key:1},D={key:2,class:"margscreen"},j={key:0,class:"content"},N=["datetime"],L={style:{"text-align":"right"}},P={style:{"text-align":"right"}},V={style:{"text-align":"right"}},R={style:{"text-align":"right"}},B={style:{"text-align":"right"}},E={key:3,class:"margscreen"},F={class:"content"};function H(s,e,m,_,q,G){return o(),n(u,null,[s.state==="homepage"?(o(),n("div",c,[s.loading?(o(),n("div",k," Chargement en cours, merci de patientier. ")):s.getstaffresponse?(o(),n("div",b,[e[7]||(e[7]=t("h2",null,"Margarita 2025",-1)),e[8]||(e[8]=t("h2",null,"ADMIN",-1)),t("h2",null,l(s.getstaffresponse.name),1),e[9]||(e[9]=t("br",null,null,-1)),t("div",null,[t("button",{onClick:e[0]||(e[0]=async()=>await this.goToOrder())},"Joueurs"),e[6]||(e[6]=t("span",{style:{visibility:"hidden"}},"99999",-1)),t("button",{onClick:e[1]||(e[1]=async()=>await this.goToOrder())},"Organisateurs")]),e[10]||(e[10]=t("br",null,null,-1)),t("div",null,[t("button",{onClick:e[2]||(e[2]=async()=>await this.goToInvoice())},"Voir factures")])])):a("",!0)])):a("",!0),s.state==="order"?(o(),n("div",w,[s.getmenuresponse?(o(),n("div",C,[e[13]||(e[13]=t("h2",null,"Commande",-1)),e[14]||(e[14]=t("br",null,null,-1)),t("table",null,[e[11]||(e[11]=t("thead",null,[t("tr",null,[t("th",null,[t("span",{style:{visibility:"hidden"}},"99")]),t("th",null,"Nom"),t("th",null,"Prix"),t("th",null,[t("span",{style:{visibility:"hidden"}},"❌")])])],-1)),t("tbody",null,[(o(!0),n(u,null,p(s.getmenuresponse,r=>(o(),n("tr",{key:r.id},[t("td",{onClick:i=>s.orderimpl[r.id]++},[s.orderimpl[r.id]>0?(o(),n("span",T,l(s.orderimpl[r.id]),1)):a("",!0)],8,I),t("td",{onClick:i=>s.orderimpl[r.id]++},l(r.name),9,O),t("td",{onClick:i=>s.orderimpl[r.id]++},l(r.price)+" €",9,$),t("td",null,[s.orderimpl[r.id]>0?(o(),n("span",{key:0,onClick:i=>s.orderimpl[r.id]--},"❌",8,A)):a("",!0)])]))),128))])]),t("div",null,[Object.values(s.orderimpl).reduce((r,i)=>r+i,0)<=0?(o(),n("span",M,e[12]||(e[12]=[d("Tapez les lignes"),t("br",null,null,-1),d("pour commander")]))):(o(),n("span",S,[t("button",{onClick:e[3]||(e[3]=async()=>await this.postOrder())},"Envoyer")]))])])):a("",!0)])):a("",!0),s.state==="invoice"?(o(),n("div",D,[s.getinvoiceresponse?(o(),n("div",j,[e[19]||(e[19]=t("h2",null,"Factures",-1)),e[20]||(e[20]=t("br",null,null,-1)),(o(!0),n(u,null,p(s.getinvoiceresponse,r=>(o(),n("div",{key:r.id},[t("div",null,[e[15]||(e[15]=d("Le ")),t("time",{datetime:r.createdDate},l(s.formatDate(r.createdDate)),9,N)]),t("table",null,[e[17]||(e[17]=t("thead",null,[t("tr",null,[t("th",{class:"noborder"},[t("span",{style:{visibility:"hidden"}},"9999999999999")]),t("th",null,"Qté"),t("th",null,"PU"),t("th",null,"Tot")])],-1)),t("tbody",null,[(o(!0),n(u,null,p(r.invoiceItems,i=>(o(),n("tr",{key:i.id},[t("td",L,l(i.menu.name),1),t("td",P,l(i.amount),1),t("td",V,l(i.menu.price),1),t("td",R,l(i.amount*i.menu.price),1)]))),128))]),t("thead",null,[t("tr",null,[e[16]||(e[16]=t("th",{class:"noborder",colspan:"3",style:{"text-align":"right"}},"Total",-1)),t("th",B,l(r.total),1)])])]),e[18]||(e[18]=t("br",null,null,-1))]))),128)),t("div",null,[t("button",{onClick:e[4]||(e[4]=async()=>await this.goToHome())},"Retour")])])):a("",!0)])):a("",!0),s.state==="ordersent"?(o(),n("div",E,[t("div",F,[e[21]||(e[21]=t("h2",null,[d("Commande envoyée au bar"),t("br"),d("avec succès")],-1)),e[22]||(e[22]=t("br",null,null,-1)),t("div",null,[t("button",{onClick:e[5]||(e[5]=async()=>await this.goToHome())},"Retour")])])])):a("",!0)],64)}const U=g(v,[["render",H],["__scopeId","data-v-e3155e64"]]),J={class:"wrapper"},z={__name:"AdmApp",setup(s){return(e,m)=>(o(),n("main",null,[t("div",J,[y(U)])]))}},Q=g(z,[["__scopeId","data-v-8c56ec79"]]);f(Q).mount("#app");
